<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyDigitalHub - Digital Subscriptions</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- IntaSend inline SDK -->
  <script src="https://js.intasend.com/intasend-inline.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-white shadow-md p-4 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <img src="assets/logo.png" alt="MyDigitalHub logo" class="h-10 w-10 object-cover rounded-md"/>
      <h1 class="text-2xl font-bold text-blue-600">MyDigitalHub</h1>
    </div>
    <nav class="hidden md:flex">
      <a href="#" class="px-4 text-gray-700 hover:text-blue-500">Home</a>
      <a href="#products" class="px-4 text-gray-700 hover:text-blue-500">Products</a>
      <a href="#contact" class="px-4 text-gray-700 hover:text-blue-500">Contact</a>
    </nav>
    <button id="mobile-menu-btn" class="md:hidden text-gray-700">Menu</button>
  </header>

  <!-- Hero Section -->
  <main class="p-6 flex-1">
    <section class="text-center mb-10">
      <h2 class="text-3xl font-bold mb-2 text-blue-600">Your One-Stop Shop for Digital Subscriptions</h2>
      <p class="text-gray-600">Affordable plans, IntaSend secure checkout in USD!</p>
    </section>

    <!-- Product Grid -->
    <section id="products" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 p-6"></section>

    <!-- Contact Form -->
    <section id="contact" class="max-w-xl mx-auto mt-16 bg-white rounded shadow p-6">
      <h3 class="text-lg font-bold text-blue-600 mb-4">Contact Us</h3>
      <form id="contact-form" class="flex flex-col gap-4">
        <input type="text" name="name" placeholder="Your Name" required class="border p-2 rounded"/>
        <input type="email" name="email" placeholder="Your Email" required class="border p-2 rounded"/>
        <textarea name="message" placeholder="Your Message" required class="border p-2 rounded"></textarea>
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Send</button>
        <p id="contact-status" class="text-green-600 text-sm mt-2 hidden"></p>
      </form>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-white p-6 text-center mt-10 border-t">
    <p class="text-gray-600">Contact us on WhatsApp: <a href="https://wa.me/254757780414" class="text-blue-500 underline">+254757780414</a></p>
    <p class="text-sm text-gray-400 mt-2">&copy; 2025 MyDigitalHub</p>
  </footer>

  <!-- JavaScript -->
  <script>
    // --- PRODUCTS (you already provided these) ---
    const products = [
      { name: 'DSTV Stream', price: 6.00, description: 'Stream live DSTV channels for 1 month.', image: 'assets/dstv.jpg' },
      { name: 'Startimes ON', price: 9.80, description: 'Watch live channels without monthly subscription.', image: 'assets/startimes.jpg' },
      { name: 'Sports TV', price: 8.50, description: 'Unlimited sports coverage including EPL, La Liga, and more.', image: 'assets/sports.jpg' },
      { name: 'Movies & Series App', price: 9.00, description: 'Unlimited access to trending movies and TV series.', image: 'assets/movies.jpg' },
      { name: 'YouTube Premium', price: 5.50, description: 'Ad-free YouTube experience with offline viewing.', image: 'assets/youtube.jpg' },
      { name: 'TikTok 18+', price: 4.00, description: 'Exclusive access to 18+ content on TikTok.', image: 'assets/tiktok.jpg' }
    ];

    // --- PUBLIC KEY (publishable) ---
    // You shared this earlier. Replace if you want another key.
    const INTASEND_PUBLIC_KEY = "ISPubKey_live_908361d5-cdb8-4590-98cc-06dc4889cbb9";

    // --- RENDER PRODUCT CARDS ---
    function createProductCard(product, index) {
      return `
        <div class="bg-white rounded-lg shadow-md p-4 flex flex-col">
          <img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover rounded-md mb-2">
          <h3 class="text-lg font-semibold">${product.name}</h3>
          <p class="text-sm text-gray-500 mb-2">$${product.price.toFixed(2)}</p>
          <p class="text-sm mb-4">${product.description}</p>

          <label for="email-input-${index}" class="text-sm text-gray-600 mb-1">Enter email for receipt</label>
          <input
            type="email"
            id="email-input-${index}"
            placeholder="you@example.com"
            class="border p-2 rounded mb-3 w-full"
            oninput="validateEmailInput(${index})"
            aria-label="customer email"
          />

          <button
            id="pay-btn-${index}"
            onclick="payWithIntaSend('${escapeJsString(product.name)}', ${product.price}, ${index})"
            class="mt-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded w-full disabled:opacity-50"
            disabled
          >
            Pay $${product.price.toFixed(2)}
          </button>
        </div>
      `;
    }

    function renderProducts() {
      const container = document.getElementById('products');
      container.innerHTML = products.map((p, i) => createProductCard(p, i)).join('');
    }

    // --- EMAIL VALIDATION / ENABLE BUTTON ---
    window.validateEmailInput = function(index) {
      const emailInput = document.getElementById(`email-input-${index}`);
      const payBtn = document.getElementById(`pay-btn-${index}`);
      if (validateEmail(emailInput.value)) {
        payBtn.disabled = false;
      } else {
        payBtn.disabled = true;
      }
    };

    function validateEmail(email) {
      return /\S+@\S+\.\S+/.test(email);
    }

    // --- PAYMENT HANDLER USING IntaSend.inline ---
    window.payWithIntaSend = function(productName, priceUSD, index) {
      const emailInput = document.getElementById(`email-input-${index}`);
      const email = emailInput ? emailInput.value.trim() : '';

      if (!validateEmail(email)) {
        alert("Please enter a valid email address before proceeding.");
        return;
      }

      if (!window.IntaSend || typeof IntaSend.inline !== 'function') {
        console.error("IntaSend SDK not loaded or inline not available.");
        alert("Payment service is currently unavailable. Please try again later.");
        return;
      }

      // Build redirect URL to pass product and email to thank-you page
      const redirectURL = `${window.location.origin}/thank-you.html?product=${encodeURIComponent(productName)}&email=${encodeURIComponent(email)}`;

      // Call IntaSend inline SDK
      IntaSend.inline({
        publicAPIKey: INTASEND_PUBLIC_KEY,
        amount: priceUSD,
        currency: "USD",
        email: email,
        redirectURL: redirectURL,
        metadata: { product: productName },
        onSuccess: function(response) {
          // SDK usually performs redirect; fallback if needed
          window.location.href = redirectURL;
        },
        onError: function(error) {
          console.error("IntaSend error:", error);
          alert("Payment failed: " + (error && error.message ? error.message : "Unknown error"));
        }
      });
    };

    // Utility to escape single quotes in product names when inserted into onclick
    function escapeJsString(s) {
      return s.replace(/\\/g, "\\\\").replace(/'/g, "\\'");
    }

    window.addEventListener('DOMContentLoaded', function() {
      renderProducts();

      // Simple Contact Form handling (client-side only)
      const contactForm = document.getElementById('contact-form');
      contactForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const status = document.getElementById('contact-status');
        status.textContent = "Thank you! We received your message and will reply soon.";
        status.classList.remove('hidden');
        contactForm.reset();
      });
    });
  </script>
</body>
</html>
